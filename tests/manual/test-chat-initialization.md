# Manual Test: Chat Initialization Fix

**Purpose:** Verify that chatId is auto-generated and messages can be sent immediately at `/`

**Prerequisites:**
- Development server running: `npm run dev`
- Browser with DevTools (Chrome/Firefox/Safari)

---

## Test 1: Basic Chat Initialization

**Steps:**
1. Open browser and navigate to: `http://localhost:3000`
2. Open DevTools Console (F12 or Cmd+Opt+I)
3. Observe the console output

**Expected Results:**
✅ Console shows: `[Chat] Auto-generating chatId: <uuid>`
✅ URL updates to: `http://localhost:3000/?chatId=<uuid>`
✅ No errors in console
✅ Chat input is ready for typing

**Screenshot Location:** `/tests/screenshots/chat-init/01-auto-generate-chatid.png`

---

## Test 2: Send First Message

**Steps:**
1. Continue from Test 1
2. Type in chat input: "Hello, this is a test message"
3. Click Submit button (or press Enter)
4. Observe Network tab and UI response

**Expected Results:**
✅ Message appears in chat UI
✅ Network tab shows POST to `/api/chat`
✅ Request includes `chatId` in body
✅ Assistant response streams back
✅ No "chatId required" errors

**Screenshot Location:** `/tests/screenshots/chat-init/02-first-message-sent.png`

---

## Test 3: Navigate Away and Back

**Steps:**
1. Note the current chatId from URL
2. Click browser back button or navigate to another page
3. Navigate back to `http://localhost:3000` (no chatId in URL)
4. Observe console

**Expected Results:**
✅ New chatId is auto-generated
✅ Console shows: `[Chat] Auto-generating chatId: <new-uuid>`
✅ New URL has different chatId than before
✅ Previous chat is not loaded
✅ Empty state is shown

**Screenshot Location:** `/tests/screenshots/chat-init/03-new-chat-on-navigate.png`

---

## Test 4: Existing chatId Preserved

**Steps:**
1. Navigate to: `http://localhost:3000/?chatId=test-chat-123`
2. Open DevTools Console
3. Observe console output

**Expected Results:**
✅ Console does NOT show "Auto-generating chatId" log
✅ URL remains: `http://localhost:3000/?chatId=test-chat-123`
✅ Existing chatId is respected
✅ Chat history for that ID is loaded (if exists)

**Screenshot Location:** `/tests/screenshots/chat-init/04-existing-chatid-preserved.png`

---

## Test 5: URL Parameters Preserved

**Steps:**
1. Navigate to: `http://localhost:3000/?model=anthropic/claude-haiku-4-5-20251001&webSearch=true`
2. Wait for page load
3. Check URL after chatId is generated

**Expected Results:**
✅ Console shows: `[Chat] Auto-generating chatId: <uuid>`
✅ URL becomes: `http://localhost:3000/?model=anthropic/claude-haiku-4-5-20251001&webSearch=true&chatId=<uuid>`
✅ Model selector shows Claude Haiku 4.5
✅ Web search toggle is enabled
✅ All parameters preserved

**Screenshot Location:** `/tests/screenshots/chat-init/05-params-preserved.png`

---

## Test 6: Multiple Browser Tabs

**Steps:**
1. Open Tab 1: Navigate to `http://localhost:3000`
2. Note chatId in URL
3. Open Tab 2: Navigate to `http://localhost:3000`
4. Note chatId in URL
5. Compare the two chatIds

**Expected Results:**
✅ Tab 1 has unique chatId: `http://localhost:3000/?chatId=<uuid-1>`
✅ Tab 2 has different chatId: `http://localhost:3000/?chatId=<uuid-2>`
✅ Both chats are independent
✅ Messages in one tab don't appear in the other

**Screenshot Location:** `/tests/screenshots/chat-init/06-multiple-tabs.png`

---

## Test 7: Console Error Check

**Steps:**
1. Navigate to: `http://localhost:3000`
2. Open DevTools Console
3. Check for any errors (red text)
4. Filter by Errors only

**Expected Results:**
✅ No errors related to chatId
✅ No "Cannot read property of undefined" errors
✅ No "chatId is required" errors
✅ Only info/debug logs present

**Acceptable Warnings:**
- HMR (Hot Module Reload) warnings in dev mode
- React DevTools warnings (if installed)

**Screenshot Location:** `/tests/screenshots/chat-init/07-no-console-errors.png`

---

## Test 8: Network Request Validation

**Steps:**
1. Navigate to: `http://localhost:3000`
2. Open DevTools Network tab
3. Type and send a message
4. Inspect the POST request to `/api/chat`
5. Check the request payload

**Expected Results:**
✅ Request URL: `http://localhost:3000/api/chat`
✅ Method: POST
✅ Request body includes:
```json
{
  "messages": [...],
  "model": "anthropic/claude-sonnet-4-5-20250929",
  "webSearch": false,
  "chatId": "<auto-generated-uuid>",
  "projectId": null
}
```
✅ chatId is a valid UUID format
✅ Response status: 200 OK

**Screenshot Location:** `/tests/screenshots/chat-init/08-network-request.png`

---

## Test 9: Mobile Responsive

**Steps:**
1. Navigate to: `http://localhost:3000`
2. Open DevTools and toggle Device Toolbar (mobile view)
3. Set device to iPhone 14 Pro
4. Test chat initialization and message sending

**Expected Results:**
✅ chatId auto-generates in mobile view
✅ Chat input is accessible and functional
✅ Submit button works on mobile
✅ No mobile-specific errors
✅ UI is responsive and usable

**Screenshot Location:** `/tests/screenshots/chat-init/09-mobile-view.png`

---

## Test 10: Rapid Message Sending

**Steps:**
1. Navigate to: `http://localhost:3000`
2. Wait for chatId to generate
3. Rapidly type and send 3 messages in quick succession:
   - Message 1: "First message"
   - Message 2: "Second message"
   - Message 3: "Third message"
4. Observe chat UI and network requests

**Expected Results:**
✅ All 3 messages are sent with same chatId
✅ All 3 messages appear in chat UI
✅ No race conditions or duplicates
✅ Messages are processed in order
✅ No state conflicts

**Screenshot Location:** `/tests/screenshots/chat-init/10-rapid-messages.png`

---

## Troubleshooting

### Issue: chatId not appearing in URL

**Check:**
- Browser console for errors
- Verify `crypto.randomUUID()` is supported (modern browser required)
- Clear browser cache and reload

### Issue: Message not sending after chatId generated

**Check:**
- Network tab for failed requests
- Console for API errors
- Verify dev server is running on port 3000

### Issue: Multiple chatIds generated on single page

**Check:**
- React StrictMode (causes double-render in dev)
- useEffect dependency array
- State conflicts with chatIdFromUrl

---

## Success Criteria

For the fix to be considered successful, ALL of these must pass:

- [x] Test 1: chatId auto-generates on page load
- [x] Test 2: Messages can be sent immediately
- [x] Test 3: New chat starts on navigation
- [x] Test 4: Existing chatIds are preserved
- [x] Test 5: URL parameters don't conflict
- [x] Test 6: Multiple tabs work independently
- [x] Test 7: No console errors
- [x] Test 8: Network requests include chatId
- [x] Test 9: Mobile view works correctly
- [x] Test 10: Rapid messages don't cause issues

---

## Manual Test Execution Log

**Tester:** _________________
**Date:** _________________
**Browser:** _________________
**OS:** _________________

| Test | Status | Notes |
|------|--------|-------|
| Test 1: Basic Init | ⬜ Pass / ❌ Fail | |
| Test 2: First Message | ⬜ Pass / ❌ Fail | |
| Test 3: Navigate Away | ⬜ Pass / ❌ Fail | |
| Test 4: Existing chatId | ⬜ Pass / ❌ Fail | |
| Test 5: URL Params | ⬜ Pass / ❌ Fail | |
| Test 6: Multiple Tabs | ⬜ Pass / ❌ Fail | |
| Test 7: Console Errors | ⬜ Pass / ❌ Fail | |
| Test 8: Network Request | ⬜ Pass / ❌ Fail | |
| Test 9: Mobile View | ⬜ Pass / ❌ Fail | |
| Test 10: Rapid Messages | ⬜ Pass / ❌ Fail | |

**Overall Result:** ⬜ PASS / ❌ FAIL

**Additional Notes:**
_________________________________________________________________
_________________________________________________________________
_________________________________________________________________

---

**Test Plan Version:** 1.0
**Last Updated:** November 28, 2025
**Related Task:** M3.5-02.4 - Chat UI Initialization Fix
